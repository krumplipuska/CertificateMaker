<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Minimal A4 Editor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
  <!-- External libs for export (CDN). Works offline once loaded. -->
  <!-- <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script> -->
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="editor.core.js" defer></script>
  <script src="core.update.js" defer></script>
  <script src="selection.store.js" defer></script>
  <script src="style.map.js" defer></script>
  <script src="editor.selection.js" defer></script>
  <script src="editor.tables.js" defer></script>
  <script src="tables.ops.js" defer></script>
  <script src="persistence.service.js" defer></script>
  <script src="export.service.js" defer></script>
  <script src="userFunctions.js" defer></script>
  <script src="app.view.render.js" defer></script>
  <script src="editor.app.js" defer></script>
</head>
<body>
  <!-- Hub view (hidden by default). All documents are stored inline in __docs__ -->
  <div id="hubView">
    <div id="hubHeader" class="hub-header">
      <div id="hubFileTitle" class="hub-title">The whole file(app) name (like index.html)</div>
      <div style="display:inline-flex;align-items:center;gap:6px">
        <button id="hubSaveBtn" class="btn hub-save" title="Save this file">
          <svg class="icon" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path d="M5 5h12v14H5z" fill="none" stroke="currentColor" stroke-width="2"/><path d="M9 5v6h6V5" fill="none" stroke="currentColor" stroke-width="2"/></svg>
          <span>Save</span>
        </button>
        <div class="menu" style="position:relative">
          <button class="btn" id="hubMoreMenuBtn" title="More options" aria-haspopup="true" aria-expanded="false">
            <svg class="icon" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><circle cx="5" cy="12" r="2"/><circle cx="12" cy="12" r="2"/><circle cx="19" cy="12" r="2"/></svg>
          </button>
          <div class="dropdown hidden" id="hubMoreMenu">
            <button id="hubSettingsBtn" class="btn mini"><svg class="icon" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 8a4 4 0 110 8 4 4 0 010-8z" fill="none" stroke="currentColor" stroke-width="2"/><path d="M4 12h2M18 12h2M12 4v2M12 18v2M6.2 6.2l1.4 1.4M16.4 16.4l1.4 1.4M17.8 6.2l-1.4 1.4M7.6 16.4l-1.4 1.4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg><span>Settings</span></button>
          </div>
        </div>
      </div>
    </div>
    <div class="hub-panel">
      <div class="hub-actions">
        <button id="newDocBtn" class="btn" title="Create new document">
          <svg class="icon" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
          <span>New</span>
        </button>
      </div>
      <div id="docList" class="doc-list" aria-label="Documents"></div>
    </div>
    <script id="__docs__" type="application/json">{ "catalog": [], "docs": {} }</script>
  </div>

  <div id="editorView" hidden>
  <!-- Top bar -->
  <div class="topbar">
    <div class="group">
      <button id="backToHubBtn" class="btn" title="Back to hub" aria-label="Back to hub">
        <svg class="icon" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path d="M15 18l-6-6 6-6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </button>
    </div>
    <div class="group">
      <button id="editToggleBtn" class="btn" aria-pressed="false" title="Toggle Edit/View mode" aria-label="Toggle Edit/View mode">
        <svg class="icon" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12z" fill="none" stroke="currentColor" stroke-width="2"></path>
          <circle cx="12" cy="12" r="3" fill="currentColor"></circle>
        </svg>
        <span>View mode</span>
      </button>
    </div>
    <div class="group">
      <button id="undoBtn" class="btn" disabled>
        <svg class="icon" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <path d="M9 8l-4 4 4 4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>Undo</span>
      </button>
      <button id="redoBtn" class="btn" disabled>
        <svg class="icon" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <path d="M15 8l4 4-4 4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>Redo</span>
      </button>
    </div>
    <div class="group" id="viewToggles">
      <label class="switch"><input id="snapToggle" type="checkbox" checked><span>Snap</span></label>
      <!-- Guides & Minimap toggles temporarily removed per request -->
      <label class="switch" style="display:none"><input id="guidesToggle" type="checkbox"><span>Guides</span></label>
      <label class="switch" style="display:none"><input id="minimapToggle" type="checkbox"><span>Minimap</span></label>
      <label class="switch" style="display:none"><input id="rulersToggle" type="checkbox"><span>Rulers</span></label>
    </div>
    <div class="group" id="docTitleGroup">
      <div class="btn" style="gap:6px">
        <svg class="icon" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path d="M4 6h16v12H4z" fill="none" stroke="currentColor" stroke-width="2"/><path d="M4 10h16" stroke="currentColor" stroke-width="2"/><path d="M8 14h8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
        <input id="docTitleInput" type="text" value="Untitled" aria-label="Document name" style="border:none;outline:none;background:transparent;color:#fff;max-width:360px" />
      </div>
    </div>
    <div class="spacer"></div>
    <div class="group">
      <button id="saveBtn" class="btn">
        <svg class="icon" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M5 5h12v14H5z" fill="none" stroke="currentColor" stroke-width="2"/>
          <path d="M9 5v6h6V5" fill="none" stroke="currentColor" stroke-width="2"/>
        </svg>
        <span>Save</span>
      </button>
      <div class="menu" style="position:relative">
        <button class="btn" id="moreMenuBtn" title="More options" aria-haspopup="true" aria-expanded="false">
          <svg class="icon" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><circle cx="5" cy="12" r="2"/><circle cx="12" cy="12" r="2"/><circle cx="19" cy="12" r="2"/></svg>
      </button>
        <div class="dropdown hidden" id="moreMenu">
          <button id="saveAsBtn" class="btn mini"><svg class="icon" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path d="M5 5h12v14H5z" fill="none" stroke="currentColor" stroke-width="2"/><path d="M9 5v6h6V5" fill="none" stroke="currentColor" stroke-width="2"/><path d="M12 13v6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M9 16h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg><span>Save As</span></button>
          <button id="savePdfBtn" class="btn mini"><svg class="icon" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 3v8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M8 9l4 4 4-4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M5 19h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg><span>Export PDF</span></button>
          <button id="exportPngBtn" class="btn mini"><svg class="icon" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 3v8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M8 9l4 4 4-4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M5 19h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg><span>Export PNG</span></button>
          <button id="exportJpgBtn" class="btn mini"><svg class="icon" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 3v8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M8 9l4 4 4-4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M5 19h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg><span>Export JPG</span></button>
          <hr/>
          <button id="settingsBtn" class="btn mini"><svg class="icon" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 8a4 4 0 110 8 4 4 0 010-8z" fill="none" stroke="currentColor" stroke-width="2"/><path d="M4 12h2M18 12h2M12 4v2M12 18v2M6.2 6.2l1.4 1.4M16.4 16.4l1.4 1.4M17.8 6.2l-1.4 1.4M7.6 16.4l-1.4 1.4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg><span>Settings</span></button>
        </div>
      </div>
    </div>
  </div>

  <div class="app">
    <aside class="side left" id="elementsPanel">
      <div class="panel-header">
        <h3>Elements</h3>
        <button class="panel-toggle" id="elementsToggle" title="Collapse/Expand Elements Panel" aria-label="Toggle Elements Panel" data-dir="left">
          <svg class="icon" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M15 6l-6 6 6 6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
      <div class="panel-content">
        <button class="btn add-el" data-add="text">Text</button>
        <button class="btn add-el" data-add="field">Field</button>
        <button class="btn add-el" data-add="rect">Rectangle</button>
        <button class="btn add-el" data-add="line">Line</button>
        <button class="btn add-el" data-add="image">Image</button>
        <button class="btn add-el" data-add="table">Table</button>
        <button class="btn add-el" data-add="block">Block</button>

        <!-- Layers and Brand sections removed per request -->
      </div>
      <div class="panel-resize-handle panel-resize-right" data-panel="elementsPanel"></div>
    </aside>

    <main class="workspace">
      <div id="pageViewport">
        <div id="pagesList" aria-label="Pages list"></div>
      </div>
    </main>

    <aside class="side right" id="propertiesPanel">
      <div class="panel-resize-handle panel-resize-left" data-panel="propertiesPanel"></div>
      <div class="panel-header">
        <h3>Properties</h3>
        <button class="panel-toggle" id="propertiesToggle" title="Collapse/Expand Properties Panel" aria-label="Toggle Properties Panel" data-dir="right">
          <svg class="icon" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M15 6l-6 6 6 6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
      <div class="panel-content">
        <div id="propertiesContent" class="props"></div>
        <div class="props" style="margin-top:12px;border-top:1px dashed var(--border);padding-top:8px">
          <div class="row"><label>Header height</label><input id="docHeaderHeight" type="number" min="0" value="10"></div>
          <div class="row"><label>Footer height</label><input id="docFooterHeight" type="number" min="0" value="10"></div>
        </div>
      </div>
    </aside>
  </div>
  <!-- Bottom-right floating zoom control -->
  <div class="zoom-control" id="zoomControl">
    <input id="zoomSlider" type="range" min="25" max="300" step="1" value="100">
    <span id="zoomLabel">100%</span>
  </div>
  <!-- aria-live region to announce selection and range changes for screen readers -->
  <div id="srAnnouncer" aria-live="polite" style="position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden"></div>

  <div id="formatToolbar" class="floating hidden" role="toolbar" aria-label="Editing toolbar">
    <div class="row">
      <label>Fill <input class="circle" type="color" data-prop="styles.fill"></label>
      <label>Text <input class="circle" type="color" data-prop="styles.textColor"></label>
      <label>Stroke <input class="circle" type="color" data-prop="styles.strokeColor"></label>
      <label>Stroke W <input type="range" min="0" max="20" step="1" style="width:120px" data-prop="styles.strokeWidth"></label>
      <label>Radius <input type="range" min="0" max="60" step="1" style="width:120px" data-prop="styles.radius"></label>
      <label>Font <select data-prop="styles.fontFamily">
        <option value="system-ui">System</option>
        <option value="Arial">Arial</option>
        <option value="Helvetica Neue">Helvetica</option>
        <option value="Times New Roman">Times</option>
        <option value="Georgia">Georgia</option>
        <option value="Courier New">Courier</option>
      </select></label>
      <label>Size <select style="width:64px" data-prop="styles.fontSize">
        <option value="8">8</option>
        <option value="9">9</option>
        <option value="10">10</option>
        <option value="11">11</option>
        <option value="12">12</option>
        <option value="14" selected>14</option>
        <option value="16">16</option>
        <option value="18">18</option>
        <option value="20">20</option>
        <option value="24">24</option>
        <option value="28">28</option>
        <option value="32">32</option>
        <option value="36">36</option>
        <option value="48">48</option>
        <option value="72">72</option>
      </select></label>
      <button class="btn mini" data-toggle="styles.bold" title="Bold" aria-label="Bold">
        <svg class="icon" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true">
          <text x="6" y="17" font-family="system-ui, -apple-system, 'Segoe UI', Roboto, Arial" font-size="16" font-weight="700" fill="currentColor">B</text>
        </svg>
      </button>
      <button class="btn mini" data-toggle="styles.italic" title="Italic" aria-label="Italic">
        <svg class="icon" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true">
          <text x="8" y="17" font-family="system-ui, -apple-system, 'Segoe UI', Roboto, Arial" font-size="16" font-style="italic" fill="currentColor">I</text>
        </svg>
      </button>
      <button class="btn mini" data-toggle="styles.underline" title="Underline" aria-label="Underline">
        <svg class="icon" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true">
          <text x="5" y="16" font-family="system-ui, -apple-system, 'Segoe UI', Roboto, Arial" font-size="16" font-weight="600" fill="currentColor">U</text>
          <line x1="5" y1="18" x2="19" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
      <button class="btn mini align h-left" id="alignHBtn" data-align-h-cycle title="Horizontal align" aria-label="Horizontal align">
        <svg class="icon" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true">
          <g class="h-icon h-left">
            <line x1="5" y1="7" x2="17" y2="7" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="5" y1="12" x2="19" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="5" y1="17" x2="14" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </g>
          <g class="h-icon h-center">
            <line x1="6" y1="7" x2="18" y2="7" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="5" y1="12" x2="19" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="7" y1="17" x2="17" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </g>
          <g class="h-icon h-right">
            <line x1="7" y1="7" x2="19" y2="7" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="5" y1="12" x2="19" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="10" y1="17" x2="19" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </g>
        </svg>
      </button>
      <button class="btn mini align v-top" id="alignVBtn" data-align-v-cycle title="Vertical align" aria-label="Vertical align">
        <svg class="icon" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true">
          <g class="v-icon v-top">
            <line x1="7" y1="5" x2="7" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="12" y1="5" x2="12" y2="19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="17" y1="5" x2="17" y2="14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="5" y1="5" x2="19" y2="5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </g>
          <g class="v-icon v-middle">
            <line x1="7" y1="7" x2="7" y2="19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="12" y1="5" x2="12" y2="19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="17" y1="8" x2="17" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="5" y1="12" x2="19" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </g>
          <g class="v-icon v-bottom">
            <line x1="7" y1="7" x2="7" y2="19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="12" y1="5" x2="12" y2="19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="17" y1="10" x2="17" y2="19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="5" y1="19" x2="19" y2="19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </g>
        </svg>
      </button>
      <label class="btn" style="gap:6px; align-items:center"><input type="checkbox" id="bgTransparentToggle"> Transparent BG</label>
    </div>
  </div>

  <div id="lasso" hidden></div>
  <style>
    /* Suppress lasso only while header/footer resizing is active */
    .hf-resizing #lasso { display:none !important; }
  </style>
  <div id="selectionBox" class="selbox hidden">
    <div class="sb-h" data-handle="nw"></div>
    <div class="sb-h" data-handle="n"></div>
    <div class="sb-h" data-handle="ne"></div>
    <div class="sb-h" data-handle="e"></div>
    <div class="sb-h" data-handle="se"></div>
    <div class="sb-h" data-handle="s"></div>
    <div class="sb-h" data-handle="sw"></div>
    <div class="sb-h" data-handle="w"></div>
    <div class="sb-h" data-handle="move" title="Drag to move"></div>
    <div class="sb-h" data-handle="rotate" title="Drag to rotate"></div>
  </div>

  <div id="elementActions" class="actions hidden" role="toolbar" aria-label="Element actions">
    <button class="btn mini" data-action="copy" title="Copy" aria-label="Copy">
      <svg class="icon" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true">
        <rect x="9" y="3" width="12" height="12" rx="2" ry="2" fill="none" stroke="currentColor" stroke-width="2"/>
        <rect x="3" y="9" width="12" height="12" rx="2" ry="2" fill="none" stroke="currentColor" stroke-width="2"/>
      </svg>
    </button>
    <button class="btn mini" data-action="delete" title="Delete" aria-label="Delete">
      <svg class="icon" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true">
        <path d="M3 6h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <path d="M8 6V4h8v2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <rect x="6" y="6" width="12" height="14" rx="2" ry="2" fill="none" stroke="currentColor" stroke-width="2"/>
        <path d="M10 11v6M14 11v6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </button>
    <button class="btn mini" data-group-toggle title="Group/Ungroup"></button>
    <div class="menu" style="position:relative">
      <button class="btn mini" data-menu="actions" title="More" aria-label="More actions">
        <svg class="icon" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true">
          <circle cx="5" cy="12" r="2" fill="currentColor"/>
          <circle cx="12" cy="12" r="2" fill="currentColor"/>
          <circle cx="19" cy="12" r="2" fill="currentColor"/>
        </svg>
      </button>
      <div class="dropdown hidden" data-menu-panel="actions" style="position:absolute;top:36px;right:0;background:#fff;border:1px solid var(--border);border-radius:8px;box-shadow:var(--shadow);padding:8px;display:flex;flex-direction:column;gap:6px;min-width:220px">
        <button class="btn mini" data-action="duplicate" title="Duplicate" style="justify-content:flex-start"><svg class="icon" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><rect x="9" y="3" width="12" height="12" rx="2" ry="2" fill="none" stroke="currentColor" stroke-width="2"/><rect x="3" y="9" width="12" height="12" rx="2" ry="2" fill="none" stroke="currentColor" stroke-width="2"/></svg><span style="margin-left:6px">Duplicate</span></button>
        <button class="btn mini" data-action="delete" title="Delete" style="justify-content:flex-start"><svg class="icon" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path d="M3 6h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M8 6V4h8v2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><rect x="6" y="6" width="12" height="14" rx="2" ry="2" fill="none" stroke="currentColor" stroke-width="2"/><path d="M10 11v6M14 11v6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg><span style="margin-left:6px">Delete</span></button>
        <hr/>
        <button class="btn mini" data-align="left" style="justify-content:flex-start"><svg class="icon" width="16" height="16" viewBox="0 0 24 24"><path d="M4 4v16M6 7h12v4H6zM6 15h8v4H6z" fill="currentColor"/></svg><span style="margin-left:6px">Left</span></button>
        <button class="btn mini" data-align="center" style="justify-content:flex-start"><svg class="icon" width="16" height="16" viewBox="0 0 24 24"><path d="M12 4v16M4 9h16v4H4z" fill="currentColor"/></svg><span style="margin-left:6px">Center</span></button>
        <button class="btn mini" data-align="right" style="justify-content:flex-start"><svg class="icon" width="16" height="16" viewBox="0 0 24 24"><path d="M20 4v16M6 7h12v4H6zM10 15h8v4h-8z" fill="currentColor"/></svg><span style="margin-left:6px">Right</span></button>
        <hr/>
        <button class="btn mini" data-align="top" style="justify-content:flex-start"><svg class="icon" width="16" height="16" viewBox="0 0 24 24"><path d="M4 4h16M7 6v12h4V6zM15 6v8h4V6z" fill="currentColor"/></svg><span style="margin-left:6px">Top</span></button>
        <button class="btn mini" data-align="middle" style="justify-content:flex-start"><svg class="icon" width="16" height="16" viewBox="0 0 24 24"><path d="M4 12h16M7 6v12h4V6zM15 8v8h4V8z" fill="currentColor"/></svg><span style="margin-left:6px">Middle</span></button>
        <button class="btn mini" data-align="bottom" style="justify-content:flex-start"><svg class="icon" width="16" height="16" viewBox="0 0 24 24"><path d="M4 20h16M7 6v12h4V6zM15 10v8h4v-8z" fill="currentColor"/></svg><span style="margin-left:6px">Bottom</span></button>
        <hr/>
        <button class="btn mini" data-distribute="v" style="justify-content:flex-start"><svg class="icon" width="16" height="16" viewBox="0 0 24 24"><path d="M4 4h16M4 20h16M6 9v6h12V9z" fill="currentColor"/></svg><span style="margin-left:6px">Vertically</span></button>
        <button class="btn mini" data-distribute="h" style="justify-content:flex-start"><svg class="icon" width="16" height="16" viewBox="0 0 24 24"><path d="M4 4v16M20 4v16M9 6h6v12H9z" fill="currentColor"/></svg><span style="margin-left:6px">Horizontally</span></button>
        <hr/>
        <button class="btn mini" data-z="front" style="justify-content:flex-start"><svg class="icon" width="16" height="16" viewBox="0 0 24 24"><path d="M3 3h8v8H3zM13 13h8v8h-8zM8 16h8v-8H8z" fill="currentColor"/></svg><span style="margin-left:6px">Bring to front</span></button>
        <button class="btn mini" data-z="back" style="justify-content:flex-start"><svg class="icon" width="16" height="16" viewBox="0 0 24 24"><path d="M3 3h8v8H3zM13 13h8v8h-8zM10 10h8V2h-8z" fill="currentColor"/></svg><span style="margin-left:6px">Send to back</span></button>
      </div>
    </div>
  </div>

  <!-- Minimal floating table action bar (appears when a table is selected) -->
  <div id="tableActions" class="hidden" role="toolbar" aria-label="Table actions">
    <button class="btn mini" data-tact="row-add">+ Row</button>
    <button class="btn mini" data-tact="col-add">+ Col</button>
    <button class="btn mini" data-tact="row-del">Del Row</button>
    <button class="btn mini" data-tact="col-del">Del Col</button>
    <button class="btn mini" data-tact="merge">Merge</button>
    <button class="btn mini" data-tact="unmerge">Unmerge</button>
    <div class="menu" style="position:relative">
      <button class="btn mini" data-menu="borders">Borders</button>
      <div class="dropdown hidden" data-menu-panel="borders" style="position:absolute;top:36px;left:0;background:#fff;border:1px solid var(--border);border-radius:8px;box-shadow:var(--shadow);padding:8px;display:flex;flex-direction:column;gap:8px;min-width:220px">
        <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:6px">
          <button class="btn mini" data-borders="all" title="All">All</button>
          <button class="btn mini" data-borders="outer" title="Outer">Outer</button>
          <button class="btn mini" data-borders="inner" title="Inner">Inner</button>
          <button class="btn mini" data-borders="none" title="None">None</button>
          <button class="btn mini" data-borders="top" title="Top">Top</button>
          <button class="btn mini" data-borders="right" title="Right">Right</button>
          <button class="btn mini" data-borders="bottom" title="Bottom">Bottom</button>
          <button class="btn mini" data-borders="left" title="Left">Left</button>
        </div>
        <div style="display:flex;align-items:center;gap:8px">
          <label>Color <input type="color" id="tblBorderColor" value="#000000"></label>
          <label>Width <input type="range" id="tblBorderWidth" min="0" max="12" step="1" value="1" style="width:120px"></label>
        </div>
      </div>
    </div>
  </div>

  <!-- Table context menu -->
  <div id="tableMenu" class="hidden" style="position:fixed; z-index:1101; background:#fff; border:1px solid var(--border); border-radius:8px; box-shadow:var(--shadow); padding:6px; display:flex; flex-direction:column; gap:4px; min-width:180px">
    <button class="btn mini" data-tm="merge">Merge cells</button>
    <button class="btn mini" data-tm="unmerge">Unmerge</button>
    <hr/>
    <button class="btn mini" data-tm="row-insert-above">Insert row above</button>
    <button class="btn mini" data-tm="row-insert-below">Insert row below</button>
    <button class="btn mini" data-tm="row-delete">Delete row</button>
    <hr/>
    <button class="btn mini" data-tm="col-insert-left">Insert column left</button>
    <button class="btn mini" data-tm="col-insert-right">Insert column right</button>
    <button class="btn mini" data-tm="col-delete">Delete column</button>
  </div>

  <!-- Element context menu -->
  <div id="elementMenu" class="hidden" style="position:fixed; z-index:1101; background:#fff; border:1px solid var(--border); border-radius:8px; box-shadow:var(--shadow); padding:6px; display:flex; flex-direction:column; gap:4px; min-width:200px">
    <button class="btn mini" data-em="duplicate">Duplicate (Ctrl+D)</button>
    <button class="btn mini" data-em="delete">Delete (Del)</button>
    <hr/>
    <button class="btn mini" data-em="group">Group</button>
    <button class="btn mini" data-em="ungroup">Ungroup</button>
    <hr/>
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:4px">
      <button class="btn mini" data-em="align-left">Align Left</button>
      <button class="btn mini" data-em="align-center">Align Center</button>
      <button class="btn mini" data-em="align-right">Align Right</button>
      <button class="btn mini" data-em="align-top">Align Top</button>
      <button class="btn mini" data-em="align-middle">Align Middle</button>
      <button class="btn mini" data-em="align-bottom">Align Bottom</button>
    </div>
    <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:4px;margin-top:4px">
      <button class="btn mini" data-em="distribute-h">Distribute H</button>
      <button class="btn mini" data-em="distribute-v">Distribute V</button>
    </div>
    <hr/>
    <button class="btn mini" data-em="z-front">Bring to front</button>
    <button class="btn mini" data-em="z-back">Send to back</button>
  </div>

  <!-- Command Palette -->
  <div id="commandPalette" class="hidden" role="dialog" aria-modal="true" aria-label="Command palette" style="position:fixed;inset:0;display:grid;place-items:center;z-index:1200;background:rgba(0,0,0,.2)">
    <div class="cpanel" style="background:#fff;border:1px solid var(--border);border-radius:12px;box-shadow:var(--shadow);width:min(640px,90vw);">
      <input id="commandInput" type="text" placeholder="Type a command… (Esc to close)" style="width:100%;box-sizing:border-box;padding:10px 12px;border:0;border-bottom:1px solid var(--border);border-radius:12px 12px 0 0;font-size:14px;outline:none">
      <div id="commandList" style="max-height:300px;overflow:auto;padding:6px;display:flex;flex-direction:column;gap:4px"></div>
    </div>
  </div>

  

  <!-- Rulers (top/left) and Minimap -->
  <div id="rulers" class="hidden" aria-hidden="true" style="display:none">
    <div id="rulerH" class="ruler h"></div>
    <div id="rulerV" class="ruler v"></div>
  </div>
  <canvas id="minimap" class="hidden" width="180" height="120" style="display:none;position:fixed;right:16px;bottom:16px;border:1px solid var(--border);border-radius:6px;background:#fff;box-shadow:var(--shadow);z-index:1050"></canvas>

  
  </div> <!-- /#editorView -->
  
  <!-- Settings dialog (global; available in hub and editor) -->
  <div id="settingsDialog" class="hidden" role="dialog" aria-modal="true" aria-label="Settings" style="position:fixed;inset:0;display:grid;place-items:center;z-index:1200;background:rgba(0,0,0,.2)">
    <div class="cpanel" style="background:#fff;border:1px solid var(--border);border-radius:12px;box-shadow:var(--shadow);width:min(420px,90vw);padding:12px 12px 10px 12px">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:8px">
        <h3 style="margin:0;font-size:16px">Settings</h3>
        <button class="btn mini" id="settingsCloseBtn" aria-label="Close settings">Close</button>
      </div>
      <div style="display:flex;align-items:center;justify-content:space-between;gap:12px">
        <div>
          <div style="font-weight:600">Autosave</div>
          <div style="font-size:12px;color:#555">When on, hub docs are saved to this file automatically.</div>
        </div>
        <label class="switch"><input id="autosaveToggle" type="checkbox" checked><span>On</span></label>
      </div>
    </div>
  </div>
</body>
</html>
